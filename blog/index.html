<!DOCTYPE html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><meta name="description" content="C3 is a programming language that builds on the syntax and semantics of the C language, with the goal of evolving it while still retaining familiarity for C programmers."><meta name="og:title" content="C3"><meta name="og:description" content="C3 is a programming language that builds on the syntax and semantics of the C language, with the goal of evolving it while still retaining familiarity for C programmers."><meta content="/logo.svg" property="og:image"><meta content="#4355ec" data-react-helmet="true" name="theme-color"><meta name="og:image" content="/logo.svg"><link rel="icon" href="/ico.svg" type="image/x-icon"><title>C3 | Blog | An evolution, not a revolution</title><link rel="stylesheet" href="/_astro/blog.B58EAuiE.css">
<link rel="stylesheet" href="/_astro/index.CLxMlQ5a.css"><script type="module" src="/_astro/page.7qqag-5g.js"></script></head> <body class="dark:bg-stone-950 bg-white"> <div style="height: auto"> <script>

	// get theme preference from local storage
	let theme = localStorage.getItem("starlight-theme");
	
	// Set existing preference of light, from previous page load
	if (theme === "light") 
	{
		document.documentElement.classList.remove("dark");
		document.documentElement.setAttribute("data-theme", "light");
	}
	// Set existing preference of dark, from previous page load
	else if (theme === "dark") 
	{
		document.documentElement.classList.add("dark");
		document.documentElement.setAttribute("data-theme", "dark");
	}
	// default to light mode if no value in local storage
	else
	{
		document.documentElement.setAttribute("data-theme", "light");
	}
	

	function toggleDarkMode() {
		// get theme preference from local storage
		let theme = localStorage.getItem("starlight-theme")

		// Switch existing preference from light to dark
		if (theme === "light") 
		{
			localStorage.setItem("starlight-theme", "dark");
			document.documentElement.classList.add("dark");
			document.documentElement.setAttribute("data-theme", "dark");
		}
		// Switch existing preference from dark to light
		else if (theme === "dark") 
		{
			localStorage.setItem("starlight-theme", "light");
			document.documentElement.classList.remove("dark");
			document.documentElement.setAttribute("data-theme", "light");
		}
		// no local storage preference, but browser prefer dark, add dark class to root html element
		else if (window.matchMedia("(prefers-color-scheme: dark)").matches) 
		{
			localStorage.setItem("starlight-theme", "dark");
			document.documentElement.classList.add("dark");
			document.documentElement.setAttribute("data-theme", "dark");
		}
		// No local storage or browser preference, add dark class to root html element
		else 
		{
			localStorage.setItem("starlight-theme", "dark");
			document.documentElement.classList.add("dark");
			document.documentElement.setAttribute("data-theme", "dark");
		}	
	}
	

	
	// is the moreDropdown menu open
	let isMoreDropdownOpen = false;
	
	document.addEventListener("mousedown", (event) => {
		moreDropdownHandleClickInner(event);
	})
	
	
	function moreDropdownHandleClickInner(event) {
		
		const dropdownParent = document.getElementById("more-dropdown-parent")
		const dropdown = document.getElementById("more-dropdown")
		
		// We clicked on the menu
		if (dropdownParent.contains(event.target)) {
			
			// if menu is open and we clicked to close it
			if (isMoreDropdownOpen) {
				isMoreDropdownOpen = false
				
				setTimeout(
					function() {
						dropdown.classList.add("hidden");
					}, 
					200,
				);
				return;
			}
			
			// Opening the menu
			isMoreDropdownOpen = true;
			
			setTimeout(
				function() {
					dropdown.classList.remove("hidden");
				}, 
				200,
			);
		
		}
		// We clicked off the menu, close the menu
		else
		{
			// Closing the menu
			isMoreDropdownOpen = false;
			
			setTimeout(
				function() {
					dropdown.classList.add("hidden");
				}, 
				200,
			);
	
		}	
	}
	
	
	
	// is the mobileMenu open
	let isMobileMenuOpen = false;
	
	document.addEventListener("mousedown", (event) => {
		mobileMenuHandleClickInner(event);
	})
	
	function mobileMenuHandleClickInner(event) {
		
		const dropdownParent = document.getElementById("mobile-menu-parent")
		const dropdown = document.getElementById("mobile-menu")
		const iconOpenMenu = document.getElementById("icon-open-mobile-menu")
		const iconCloseMenu = document.getElementById("icon-close-mobile-menu")
		
		
		// We clicked on the menu
		if (dropdownParent.contains(event.target)) {
			
			// if menu is open and we clicked to close it
			if (isMobileMenuOpen) {
				isMobileMenuOpen = false
				
				dropdown.classList.add("hidden");
				iconOpenMenu.classList.remove("hidden");
				iconCloseMenu.classList.add("hidden");
				
				return;
			}
			
			// Opening the menu
			isMobileMenuOpen = true;
			
			dropdown.classList.remove("hidden");
			iconOpenMenu.classList.add("hidden");
			iconCloseMenu.classList.remove("hidden");
		}	
	}	
	
</script> <header class="
	flex 
	flex-wrap 
	sm:justify-start 
	sm:flex-nowrap 
	z-50 
	w-full 
	border-b 
	border-gray-200
	text-sm 
	py-3 
	sm:py-0 
	dark:border-stone-700
	"> <nav class="
		relative 
		max-w-7xl 
		w-full 
		mx-auto 
		px-4 
		sm:flex 
		sm:items-center 
		sm:justify-between 
		sm:px-6 
		lg:px-8
		" aria-label="Global"> <div class="
			flex 
			items-center 
			justify-between
			"> <a class="
				text-blue-600
				dark:text-blue-500
				flex-none 
				text-xl 
				font-semibold 
				" href="/" aria-label="Brand">
C3
</a> <div class="sm:hidden" id="mobile-menu-parent"> <!-- Mobile topMenu toggle --> <button class="
					hs-collapse-toggle 
					p-2 
					inline-flex 
					justify-center 
					items-center 
					gap-2 
					rounded-md border 
					font-medium 
					bg-white 
					text-stone-700 
					shadow-sm 
					align-middle 
					hover:bg-gray-50 
					focus:outline-none 
					focus:ring-2 
					focus:ring-offset-2 
					focus:ring-offset-white 
					focus:ring-blue-600 
					transition-all 
					text-sm 
					dark:bg-slate-900 
					dark:hover:bg-slate-800 
					dark:border-stone-700 
					dark:text-gray-400 
					dark:hover:text-white 
					dark:focus:ring-offset-stone-950" type="button" aria-controls="mobile-menu" aria-label="Toggle navigation"> <!-- Icon openMobileMenu --> <svg class="
						opacity-100
						w-4 
						h-4
						" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" id="icon-open-mobile-menu"> <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"></path> </svg> <!-- Icon closeMobileMenu --> <svg class="
						hidden 
						w-4 
						h-4
						" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" id="icon-close-mobile-menu"> <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path> </svg> </button> </div> </div> <!-- mobile menu --> <div class="
			hidden 
			sm:block
			overflow-hidden 
			
			transition-all 
			duration-1000 
			ease-linear
			
			basis-full 
			grow 
			" id="mobile-menu"> <div class="
				flex 
				flex-col 
				gap-y-4 
				gap-x-0 
				mt-5 
				sm:flex-row 
				sm:items-center 
				sm:justify-end 
				sm:gap-y-0 
				sm:gap-x-7 
				sm:mt-0 
				sm:pl-7"> <a class="font-medium text-gray-500 hover:text-blue-500 sm:py-6 dark:text-gray-400 dark:hover:text-blue-500" href="/getting-started/">Docs</a> <a class="font-medium text-gray-500 hover:text-blue-500 sm:py-6 dark:text-gray-400 dark:hover:text-blue-500" href="/language-overview/examples">Examples</a> <a class="font-medium text-gray-500 hover:text-blue-500 sm:py-6 dark:text-gray-400 dark:hover:text-blue-500" href="/getting-started/prebuilt-binaries">Download</a> <a class="font-medium text-gray-500 hover:text-blue-500 sm:py-6 dark:text-gray-400 dark:hover:text-blue-500" href="https://discord.gg/qN76R87">
Discord
</a> <a class="font-medium text-gray-500 hover:text-blue-500 sm:py-6 dark:text-gray-400 dark:hover:text-blue-500" href="/blog">
Blog
</a> <div class="
					hs-dropdown [--strategy:static] 
					sm:[--strategy:fixed] 
					[--adaptive:none] 
					sm:[--trigger:hover] 
					sm:py-4
					"> <!-- Desktop toggle More dropdown menu --> <button id="more-dropdown-parent" type="button" class="flex items-center w-full text-stone-600 hover:text-blue-500 font-medium dark:text-gray-400 dark:hover:text-blue-500">
More
<svg class="ml-2 w-2.5 h-2.5 text-stone-600" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M2 5L8.16086 10.6869C8.35239 10.8637 8.64761 10.8637 8.83914 10.6869L15 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path> </svg> </button> <!-- Desktop More dropdown menu --> <div id="more-dropdown" class="
						hidden
						absolute
						top-full 
						sm:right-[4rem]
						z-10
						sm:w-52 
						bg-white
						rounded-lg
						sm:border 
						sm:dark:border
						border-gray-200
						shadow-md
						dark:bg-stone-950 
						dark:border-stone-700 
						sm:mt-1
						mt-[-1.5rem]
						p-2			
						"> <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-md font-medium text-stone-600 hover:text-white hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:bg-blue-700 dark:hover:text-gray-100" href="https://github.com/c3lang/c3c">
Github
</a> <a class="flex items-center gap-x-3.5 py-2 px-3 rounded-md font-medium text-stone-600 hover:text-white hover:bg-blue-600 focus:ring-2 focus:ring-blue-500 dark:text-gray-400 dark:hover:bg-blue-700 dark:hover:text-gray-100" href="https://github.com/sponsors/c3lang">
Support us
</a> </div> </div> <!-- Enable dark mode, from light mode --> <a class="
					group
					flex 
					items-center 
					text-gray-600 
					hover:text-blue-600 
					font-medium 
					dark:hidden
					dark:text-gray-400 
					dark:hover:text-gray-500
					" href="#!" onclick="toggleDarkMode()"> <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"> <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278zM4.858 1.311A7.269 7.269 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.316 7.316 0 0 0 5.205-2.162c-.337.042-.68.063-1.029.063-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286z"></path> </svg> </a> <!-- Enable light mode from dark mode --> <a class="
					hidden 
					dark:flex
					group 
					items-center 
					text-gray-600 
					hover:text-blue-600 
					font-medium 
					dark:text-gray-400 
					dark:hover:text-gray-500
					" href="#!" onclick="toggleDarkMode()"> <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"> <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path> </svg> </a> </div> </div> </nav> </header> <div> <div class="
				max-w-[38rem]
				
				lg:grid
				xl:grid-cols-[1.5fr_40rem_1.5fr]
				xl:max-w-[calc(20rem+40rem+20rem)]
				lg:grid-cols-[40rem_1.5fr]
				lg:max-w-[calc(40rem+20rem)]
				mx-auto
			"> <!-- Empty content for symmetry and centering of main content --> <div class="hidden xl:block"></div> <!-- Main content --> <div class="
					px-4 
					sm:px-6 
					lg:px-8 
					lg:pt-24 
					pt-8
					"> <div class="mt-5 mx-auto"> <h1 class="
							block 
							font-bold 
							text-gray-800 
							text-5xl 
							lg:text-6xl 
							lg:leading-tight 
							dark:text-white
							text-justify
							mb-8
							sm:mb-18
							"> <a href="/blog">
The
<span class="
									bg-clip-text 
									bg-gradient-to-l 
									from-violet-600 
									to-blue-600 
									text-transparent">
C3
</span>
Blog
</a> </h1> <!-- Show only current blogpost --> <!-- Using CSS variables from global styles, since those change with dark mode --><div class="
	lg:my-20
	 astro-izoogwj6"> <h2 class="
		text-3xl 
		lg:text-4xl 
		font-bold 
		dark:text-white
		mb-2
		text-justify
	 astro-izoogwj6"> Forget Borrow Checkers: C3 Solved Memory Lifetimes With Scopes </h2> <p class="
		text-md
		lg:text-l 
		text-gray-800 
		dark:text-white
		mb-12
		sm:mb-16
		text-justify
	 astro-izoogwj6"> 2025-07-11 </p> <div class="
		text-justify
		 astro-izoogwj6" id="child_slots">  <p>Modern languages offer a variety of techniques to help with dynamic memory management, each one a different tradeoff in terms of performance, control and complexity. In this post we’ll look at an old idea, memory allocation regions or arenas, implemented via the C3 Temp allocator, which is the new default for C3.</p>
<p>The Temp allocator combines the ease of use of garbage collection with C3’s unique features to give a simple and (semi)-automated solution within a manual memory management language. The Temp allocator helps you avoid memory leaks, improve performance, and simplify code compared to traditional approaches.</p>
<p>Memory allocations come in two broad types <a href="https://en.wikipedia.org/wiki/Stack_register">stack</a> allocations which are compact, efficient and automatic and heap allocations which are much larger and have <a href="https://en.wikipedia.org/wiki/Memory_management">customisable organisation</a>. Custom organisation allows both innovation and footguns in equal measure, let’s explore those.</p>
<h3 id="memory-leaks">Memory Leaks</h3>
<p>When we dynamically allocate memory, with say <code dir="auto">malloc()</code> typically we need to <code dir="auto">free()</code> it afterwards, otherwise we can’t use that memory until the OS process exits. If that memory isn’t being used and it has not been freed this is called a <a href="https://en.wikipedia.org/wiki/Memory_leak">memory leak</a> and can lead to restricting or running out of available system memory.</p>
<h3 id="avoiding-memory-leaks">Avoiding Memory Leaks</h3>
<p>Common solutions are <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>, <a href="https://en.wikipedia.org/wiki/Reference_counting">reference counting</a> or <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">garbage collection</a> which automatically free those variables.</p>
<p>Each method has different tradeoffs.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a> needs classes or structs to manage their own memory cleanup with a lot of extra code.</li>
<li><a href="https://en.wikipedia.org/wiki/Reference_counting">Reference counting</a> counts how many users each memory allocation has, when this hits zero the memory is freed. Reference counting is expensive with multiple CPU cores as we need to synchronise these counts and share information between cores.</li>
<li><a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">Garbage collection</a> competes with the program for both memory and CPU time, reducing program performance and increasing memory usage.</li>
</ul>
<h2 id="memory-allocation-regions">Memory Allocation Regions</h2>
<p>Memory allocation regions, go by various names: arenas, pools, contexts; The idea dates back to the 1960’s with the IBM OS/360 mainframes having a similar system. Memory regions are efficient for managing many memory allocations and can be freed in a single operation, and are particularly effective when we know the memory will not be needed later. That is, we know the memory’s lifetime. This idea is powerful and used in many applications like web server request handlers or database transactions, as used by the <a href="https://httpd.apache.org/">Apache webserver</a> and the <a href="https://www.postgresql.org/">Postgres database</a>.</p>
<p>Memory allocation regions use a single buffer so have good locality because all the allocations are closely associated together, making it more efficient for CPU access, compared to traditional <code dir="auto">malloc</code> where allocations are spread throughout the heap.</p>
<p>Memory allocation regions may make it easier to manage memory, however you still need to <em>remember</em> to free them, and if you forget to do call free, then that memory will still leak.</p>
<h3 id="enter-the-temp-allocator">Enter The Temp Allocator</h3>
<p>The Temp allocator in C3 is a region based allocator which is <em>automatically</em> reset once execution leaves its scope, so you cannot forget to free the memory and can’t leak memory. The Temp allocator in C3 is a builtin in the standard library, called <code dir="auto">@pool()</code> and using it you can define the scope where the allocated variables are available, for example:</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v4551.css"><script type="module" src="/_astro/ec.8zarh.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="c"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">input</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">@</span><span style="--0:#82AAFF;--1:#3B61B0">pool()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#919F9F;--1:#5D6376">// Allocate temp_variable on the heap with Temp allocator</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">mem::tnew(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">56</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">input </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> input </span><span style="--0:#7FDBCA;--1:#096E72">+</span><span style="--0:#D6DEEB;--1:#403F53"> temp_variable;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> input;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">};</span><span style="--0:#919F9F;--1:#5D6376"> // Automatically cleanup temp_variable</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn </span><span style="--0:#C792EA;--1:#8844AE">void</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">main</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#D6DEEB;--1:#403F53"> result </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example(</span><span style="--0:#F78C6C;--1:#AA0982">1</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#82AAFF;--1:#3B61B0">assert(result </span><span style="--0:#C792EA;--1:#8844AE">==</span><span style="--0:#82AAFF;--1:#3B61B0"> </span><span style="--0:#F78C6C;--1:#AA0982">57</span><span style="--0:#82AAFF;--1:#3B61B0">, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#984E4D">The result should be 57</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn int example(int input){    @pool()    {        // Allocate temp_variable on the heap with Temp allocator        int* temp_variable = mem::tnew(int);        *temp_variable = 56;        input = input + temp_variable;        return input;    }; // Automatically cleanup temp_variable}fn void main(){    int result = example(1);    assert(result == 57, &#x22;The result should be 57&#x22;);}"><div></div></button></div></figure></div>
<h3 id="check-with-valgrind">Check With Valgrind</h3>
<p>Valgrind is a tool which detects memory leaks and we can use it to show the temp allocator managed the memory for us automatically.</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre data-language="bash"><code><div class="ec-line"><div class="code"><span style="--0:#82AAFF;--1:#3B61B0">valgrind</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">./pool_example</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">|</span><span style="--0:#D6DEEB;--1:#403F53">&#x26; </span><span style="--0:#82AAFF;--1:#3B61B0">grep</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#984E4D">All heap blocks were freed</span><span style="--0:#D9F5DD;--1:#111111">"</span></div></div><div class="ec-line"><div class="code"><span style="--0:#ECC48D;--1:#3B61B0">==129129==</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">All</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">heap</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">blocks</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">were</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">freed</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">--</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">no</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">leaks</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">are</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#ECC48D;--1:#3B61B0">possible</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="valgrind ./pool_example |&#x26; grep &#x22;All heap blocks were freed&#x22;==129129== All heap blocks were freed -- no leaks are possible"><div></div></button></div></figure></div>
<h3 id="success">Success!</h3>
<p>We have relatively performant memory allocations managed automatically without needing <a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a>, <a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">garbage collection</a> or <a href="https://en.wikipedia.org/wiki/Reference_counting">reference counting</a>.</p>
<h2 id="controlling-variable-cleanup">Controlling Variable Cleanup</h2>
<p>Normally temp allocated variables are cleaned up at the end of the closest <code dir="auto">@pool</code> scope, but what if you have nested <code dir="auto">@pool</code> and want explicit control over when it’s cleaned up? Simple: assign the temp allocator with the scope you need to a variable, and use it explicitly. The temp allocator in a scope is a global variable called <code dir="auto">tmem</code>.</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="c"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn String</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">input</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// previous global temp allocator from main() scope</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">Allocator temp_allocator </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> tmem;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">@</span><span style="--0:#82AAFF;--1:#3B61B0">pool()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#919F9F;--1:#5D6376">// Allocate on the global temp allocator</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">String</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> returned </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">allocator::new(temp_allocator, String)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">returned </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">string::format(temp_allocator, </span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#ECC48D;--1:#984E4D">modified </span><span style="--0:#82AAFF;--1:#3B61B0">%s</span><span style="--0:#D9F5DD;--1:#111111">"</span><span style="--0:#82AAFF;--1:#3B61B0">, input)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> returned;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">};</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn </span><span style="--0:#C792EA;--1:#8844AE">void</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">main</span><span style="--0:#D6DEEB;--1:#403F53">()</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// top-most temp allocator, tmem created here</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">@</span><span style="--0:#82AAFF;--1:#3B61B0">pool()</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">        </span></span><span style="--0:#D6DEEB;--1:#403F53">String</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> returned </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example(</span><span style="--0:#F78C6C;--1:#AA0982">42</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#919F9F;--1:#5D6376">// "modified 42" string returned</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#82AAFF;--1:#3B61B0">io::printn(</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#82AAFF;--1:#3B61B0">returned)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">};</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn String* example(int input){    // previous global temp allocator from main() scope    Allocator temp_allocator = tmem;    @pool()    {        // Allocate on the global temp allocator        String* returned = allocator::new(temp_allocator, String);        *returned = string::format(temp_allocator, &#x22;modified %s&#x22;, input);        return returned;    };}fn void main(){    // top-most temp allocator, tmem created here    @pool()    {        String* returned = example(42);        // &#x22;modified 42&#x22; string returned        io::printn(*returned);    };}"><div></div></button></div></figure></div>
<h3 id="a-handy-shorthand">A Handy Shorthand</h3>
<p>We can reduce the code’s nesting using short function declaration syntax <code dir="auto">=></code> making it even simpler as:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="c"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">input</span><span style="--0:#D6DEEB">) </span></span><span style="--0:#C792EA;--1:#8844AE">=></span><span style="--0:#D6DEEB;--1:#403F53"> @</span><span style="--0:#82AAFF;--1:#3B61B0">pool</span><span style="--0:#D6DEEB;--1:#403F53">(reserve: </span><span style="--0:#F78C6C;--1:#AA0982">2048</span><span style="--0:#D6DEEB;--1:#403F53">)</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// Allocate temp_variable on the heap</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">mem::tnew(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">56</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">input </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> input </span><span style="--0:#7FDBCA;--1:#096E72">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">temp_variable;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> input;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn int example(int input) => @pool(reserve: 2048){    // Allocate temp_variable on the heap    int* temp_variable = mem::tnew(int);    *temp_variable = 56;    input = input + *temp_variable;    return input;}"><div></div></button></div></figure></div>
<h3 id="in-simple-cases-omit-pool">In Simple Cases Omit @pool()</h3>
<p>Happy with the defaults? We can actually omit the <code dir="auto">@pool()</code> in <code dir="auto">main()</code> all together!</p>
<p>The compiler automatically adds a <code dir="auto">@pool()</code> scope to the <code dir="auto">main()</code> function for us, once it finds a temp allocation function like <code dir="auto">mem::tnew()</code>, without an enclosing <code dir="auto">@pool()</code> scope. That simplifies our code to:</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre data-language="c"><code><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">fn </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">example</span><span style="--0:#D6DEEB;--1:#403F53">(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--1:#403F53"><span style="--0:#D6DEEB"> </span><span style="--0:#D7DBE0">input</span><span style="--0:#D6DEEB">)</span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">{</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// Allocate temp_variable on the heap</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#919F9F;--1:#5D6376">// @pool() temp allocator created for us by the compiler</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53"> temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#82AAFF;--1:#3B61B0">mem::tnew(</span><span style="--0:#C792EA;--1:#8844AE">int</span><span style="--0:#82AAFF;--1:#3B61B0">)</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">temp_variable </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#F78C6C;--1:#AA0982">56</span><span style="--0:#D6DEEB;--1:#403F53">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#D6DEEB;--1:#403F53">    </span></span><span style="--0:#D6DEEB;--1:#403F53">input </span><span style="--0:#C792EA;--1:#8844AE">=</span><span style="--0:#D6DEEB;--1:#403F53"> input </span><span style="--0:#7FDBCA;--1:#096E72">+</span><span style="--0:#D6DEEB;--1:#403F53"> </span><span style="--0:#7FDBCA;--1:#096E72">*</span><span style="--0:#D6DEEB;--1:#403F53">temp_variable;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#C792EA;--1:#8844AE">return</span><span style="--0:#D6DEEB;--1:#403F53"> input;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#D6DEEB;--1:#403F53">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="fn int example(int input){    // Allocate temp_variable on the heap    // @pool() temp allocator created for us by the compiler    int* temp_variable = mem::tnew(int);    *temp_variable = 56;    input = input + *temp_variable;    return input;}"><div></div></button></div></figure></div>
<h2 id="conclusion">Conclusion</h2>
<p>The Temp allocator has landed in C3; combining scoped compile time known memory lifetimes, ease of use and performance. Tying memory lifetimes to scope and automating cleanup, you get the benefits of manual control without the risks. No more memory leaks, use after free, or slow compile times with complex ownership tracking.</p>
<p>Whether you’re building low-latency systems or just want more explicit code without garbage collection overhead, the C3 Temp allocator is a powerful tool to have in your arsenal, making memory management nearly effortless.</p>
<h2 id="want-to-dive-into-c3">Want To Dive Into C3?</h2>
<p>Check out the <a href="/getting-started">documentation</a> or <a href="/getting-started/prebuilt-binaries">download it and try it out</a>.</p>
<p>Have questions? Come and chat with us on <a href="https://discord.gg/qN76R87">Discord</a>.</p>  <!-- Markdown will be inserted here --> </div> </div> </div> </div> <!-- End of main content --> <!-- Sidebar on desktop --> <!-- Bottom on small/mobile --> <div class="
					block 
					lg:mt-68
					px-6
					lg:pl-16
					mb-20
					lg:mb-0
					"> <h2 class="
						text-[var(--sl-color-gray-1)]
						mb-4
						font-semibold
						lg:font-medium
						text-3xl
						lg:text-xl
						lg:pl-4
						lg:pt-0
						pt-6
					">
Blog Archive
</h2> <div class="
							hover:bg-slate-100
							hover:dark:bg-slate-800
							py-2
							px-4
							my-2
						"> <a class="
								text-[var(--sl-color-text-accent)]
								text-justify
								" href="/blog/c3-0-7-3-small-improvements"> <div class="
									flex
									flex-col
									text-[var(--sl-color-gray-1)]
									lg:text-xs
									
								"> <h4 class="
										"> C3 0.7.3 - Small Improvements </h4> <p class=""> 2025-07-05 </p> </div> </a> </div><div class="
							hover:bg-slate-100
							hover:dark:bg-slate-800
							py-2
							px-4
							my-2
						"> <a class="
								text-[var(--sl-color-text-accent)]
								text-justify
								" href="/blog/c3-0-7-2-quality-of-life"> <div class="
									flex
									flex-col
									text-[var(--sl-color-gray-1)]
									lg:text-xs
									
								"> <h4 class="
										"> C3 0.7.2 - Quality Of Life </h4> <p class=""> 2025-06-02 </p> </div> </a> </div><div class="
							hover:bg-slate-100
							hover:dark:bg-slate-800
							py-2
							px-4
							my-2
						"> <a class="
								text-[var(--sl-color-text-accent)]
								text-justify
								" href="/blog/c3-0-7-1-operator-overloading"> <div class="
									flex
									flex-col
									text-[var(--sl-color-gray-1)]
									lg:text-xs
									
								"> <h4 class="
										"> C3 0.7.1 - Operator Overloading </h4> <p class=""> 2025-04-30 </p> </div> </a> </div><div class="
							hover:bg-slate-100
							hover:dark:bg-slate-800
							py-2
							px-4
							my-2
						"> <a class="
								text-[var(--sl-color-text-accent)]
								text-justify
								" href="/blog/c3-0-7-0-one-step-closer-to-1-0"> <div class="
									flex
									flex-col
									text-[var(--sl-color-gray-1)]
									lg:text-xs
									
								"> <h4 class="
										"> C3 0.7.0 - One Step Closer To 1.0 </h4> <p class=""> 2025-03-30 </p> </div> </a> </div> </div> <!-- End of Sidebar --> </div> <!-- End of page grid layout for sidebar and main --> </div> </div> </body>